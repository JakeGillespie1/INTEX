<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no"
        />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>User Information</title>
        <!-- Favicon-->
        <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
        <!-- Bootstrap icons-->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css"
            rel="stylesheet"
            type="text/css"
        />
        <!-- Google fonts-->
        <link
            href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic"
            rel="stylesheet"
            type="text/css"
        />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="/css/styles.css" rel="stylesheet" />
    </head>
    <!-- Onload call set up page function -->
    <body onload="loggedIn();">
        <!-- Navigation-->
        <nav class="navbar navbar-light bg-light static-top">
            <div class="container">
                <a class="navbar-brand" href="/"><img src="/assets/img/provo welcome.png" height="100" alt="Welcome Provo Icon"></a>
                <div style="display: flex;">
                    <a class="btn btn-secondary" href="/"
                        >Home</a
                    >
                    <a class="btn btn-secondary" href="survey"
                        >Survey</a
                    >
                    <a class="btn btn-secondary" href="dashboard"
                        >Dashboard</a
                    >
                    <a
                        id="createacc"
                        style="display: none; margin-right: 10px;"
                        class="btn btn-warning"
                        href="register"
                        >Create New Account</a
                    >
                    <form action="/" method="GET">
                        <button
                            type="submit"
                            style="display: none"
                            class="btn btn-primary"
                            onclick="localStorage.clear();"
                            id="btnLogout"
                        ></button>
                    </form>
                    <a class="btn btn-primary" href="login" id="loginhref"
                        >Login</a
                    >
                </div>
            </div>
        </nav>
        <!-- Masthead-->
        <header class="masthead" id="Login">
            <div class="container position-relative">
                <div class="row justify-content-center">
                    <div class="col-xl-6">
                        <div class="text-center text-white">
                            <h1 class="mb-5">User Information Form</h1>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <!-- Image Showcases-->
        <section class="showcase">
            <div class="row justify-content-center">
                <div class="col-xl-10 col-lg-12 col-md-9">
                    <div class="card o-hidden border-0 shadow-lg my-5">
                        <div class="card-body p-0">
                            <!-- Nested Row within Card Body -->
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="p-5">
                                        <br />
                                        <div class="row justify-content-md-center">
                                            <div class="col-5 text-center">
                                                <form
                                                action="/showUsers"
                                                method="get"
                                                >
                                                    <% if (userInfoAdmin.length > 1) { %>
                                                    <select class="form-select form-select-sm" id="responseSelector" name="responseSelector">
                                                        <option value="all">View All</option>
                                                        <% userInfoAdmin.forEach(results => { %>
                                                            <option value="<%= results.user_id %>"><%= results.user_id %></option>
                                                        <% }); %>
                                                    </select>
                                                    <button type="submit" id=btnFilter class="btn btn-primary"><% if (userInfoAdmin.length > 1){ %>View Record<%} else {%>Back to All Records<%}%></button>
                                                    <% }; %>
                                                    <%if (userInfoAdmin.length == 1) {%>
                                                    <select class="form-select form-select-sm" id="responseSelector" name="responseSelector">
                                                        <% userInfoAdmin.forEach(results => { %>
                                                            <option value="<%= results.user_id %>"><%= results.user_id %></option>
                                                        <% }); %>
                                                    </select>
                                                    <button type="submit" id=btnFilter class="btn btn-primary"><% if (userInfoAdmin.length > 1){ %>View Record<%} else {%>Back to All Records<%}%></button>
                                                </form>
                                                    <form action="/showUser" method="post">
                                                        <button type="submit" id="editUser" class="btn btn-primary">Edit User</button>
                                                    <%};%>
                                            </div>
                                        </div>
                                        <br />
                                        <table
                                        class="table table-striped"
                                            style="
                                                width: 100%;
                                                background-color: RGBA(248, 249, 250, var(--bs-bg-opacity, 1));
                                                border: 1px solid black;
                                            "
                                            id="userDataTable"
                                        >
                                            <thead style="background-color: #24A5DE; color: white">
                                                <tr>
                                                    <th style="text-align: left">UserID</th>
                                                    <th style="text-align: left">First Name</th>
                                                    <th style="text-align: left">Last Name</th>
                                                    <th style="text-align: left">Email Address</th>
                                                    <th style="text-align: left">Password</th>
                                                    <th style="text-align: left">Admin Status</th>
                                                </tr>
                                            </thead>
                                            <tbody style="font-family: Arial; font-size: 9pt">
                                                <% for (let iCount = 0; iCount < userInfoAdmin.length; iCount++) { %>
                                                <tr>
                                                    <td name="user_id"><%= userInfoAdmin[iCount].user_id %></td>
                                                    <td><%= userInfoAdmin[iCount].first_name%></td>
                                                    <td><%= userInfoAdmin[iCount].last_name %></td>
                                                    <td><%= userInfoAdmin[iCount].email%></td>
                                                    <td><%= userInfoAdmin[iCount].password %></td>
                                                    <td><%= userInfoAdmin[iCount].is_admin %></td>
                                                </tr>
                                                <% } %>
                                            </tbody>
                                        </table>
                                    </div>
                                                    </form>
                                        <hr />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

                <!-- Call to Action-->
                <section class="call-to-action text-white text-center" id="loginblue">
                    <div class="container position-relative">
                        <div class="row justify-content-center">
                            <div class="col-xl-6">
                                <!-- Signup form-->
                                <!-- * * * * * * * * * * * * * * *-->
                                <!-- * * SB Forms Contact Form * *-->
                                <!-- * * * * * * * * * * * * * * *-->
                                <!-- This form is pre-integrated with SB Forms.-->
                                <!-- To make this form functional, sign up at-->
                                <!-- https://startbootstrap.com/solution/contact-forms-->
                                <!-- to get an API token!-->
                                <form
                                    class="form-subscribe"
                                    id="contactFormFooter"
                                    data-sb-form-api-token="API_TOKEN"
                                >
                                    <!-- Email address input-->
                                    <div class="row">
                                        <div class="col">
                                            <div
                                                class="invalid-feedback text-white"
                                                data-sb-feedback="emailAddressBelow:required"
                                            >
                                                Email Address is required.
                                            </div>
                                            <div
                                                class="invalid-feedback text-white"
                                                data-sb-feedback="emailAddressBelow:email"
                                            >
                                                Email Address Email is not valid.
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Submit success message-->
                                    <!---->
                                    <!-- This is what your users will see when the form-->
                                    <!-- has successfully submitted-->
                                    <div class="d-none" id="submitSuccessMessage">
                                        <div class="text-center mb-3">
                                            <div class="fw-bolder">
                                                Form submission successful!
                                            </div>
                                            <p>To activate this form, sign up at</p>
                                            <a
                                                class="text-white"
                                                href="https://startbootstrap.com/solution/contact-forms"
                                                >https://startbootstrap.com/solution/contact-forms</a
                                            >
                                        </div>
                                    </div>
                                    <!-- Submit error message-->
                                    <!---->
                                    <!-- This is what your users will see when there is-->
                                    <!-- an error submitting the form-->
                                    <div class="d-none" id="submitErrorMessage">
                                        <div class="text-center text-danger mb-3">
                                            Error sending message!
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </section>

        <!-- Footer-->
        <footer class="footer bg-light">
            <div class="container">
                <div class="row">
                    <div
                        class="col-lg-6 h-100 text-center text-lg-start my-auto"
                    >
                        <ul class="list-inline mb-2">
                            <li class="list-inline-item">
                                <a href="/">About</a>
                            </li>
                            <li class="list-inline-item">⋅</li>
                            <li class="list-inline-item">
                                <a href="contact">Contact</a>
                            </li>
                            <li class="list-inline-item">⋅</li>
                            <li class="list-inline-item">
                                <a href="termsOfUse">Terms of Use</a>
                            </li>
                        </ul>
                        <p class="text-muted small mb-4 mb-lg-0" id = Copyrite>
                        </p>
                    </div>
                    <div class="col-lg-6 h-100 text-center text-lg-end my-auto">
                        <ul class="list-inline mb-0">
                            <li class="list-inline-item me-4">
                                <a href="https://www.facebook.com/provocity/"
                                    ><i class="bi-facebook fs-3"></i
                                ></a>
                            </li>
                            <li class="list-inline-item me-4">
                                <a
                                    href="https://www.youtube.com/@ProvoCityGovernment"
                                    ><i class="bi-twitter fs-3"></i
                                ></a>
                            </li>
                            <li class="list-inline-item">
                                <a
                                    href="https://www.instagram.com/provocity/?hl=en"
                                    ><i class="bi-instagram fs-3"></i
                                ></a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </footer>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
        <!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
        <!-- * *                               SB Forms JS                               * *-->
        <!-- * * Activate your form at https://startbootstrap.com/solution/contact-forms * *-->
        <!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
        <script src="https://cdn.startbootstrap.com/sb-forms-latest.js"></script>
        <script>
            /*This funciton will set up the page.
            Page setup includes determining the proper buttons to display based on login information,
            grabbing the current year to display on the copyright,
            and setting up the email error message.*/
        /*Confirms admin or logged-in status, grabs the date for the copyright tag*/
        function loggedIn(){
            let dDate = new Date();
                    dDate = dDate.getFullYear().toString();
                    document.getElementById("Copyrite").innerHTML = "&copy; Provo City " + dDate +". All Rights Reserved.";

            if (localStorage.getItem('is_admin').includes("true")) {
                    document.getElementById('createacc').style.display =
                        'block';}

                let fName = localStorage.getItem('first_name');
                let lName = localStorage.getItem('last_name');
                if (!fName) {
                    document.getElementById('btnLogout').style.display = 'none';
                    document.getElementById('createacc').style.display = 'none';
                } else {
                    document.getElementById('loginhref').style.display = 'none';
                    document.getElementById('btnLogout').textContent =
                        'Logout ' + fName + ' ' + lName;
                    document.getElementById('btnLogout').style.display =
                        'block';}
        }

        function editUser(){
            if (document.getElementById("btnFilter").innerText.includes("Back to All Records"))
            {
                document.getElementById("editUser").style.display = "block";
            }
            else
            {
                document.getElementById("editUser").style.display = "none";
            }
        }
        </script>
    </body>
</html>
